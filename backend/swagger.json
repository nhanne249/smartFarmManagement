{
  "openapi": "3.0.0",
  "info": {
    "title": "Smart Farm Management API",
    "version": "1.0.0",
    "description": "API documentation for the Smart Farm Management system."
  },
  "servers": [
    {
      "url": "http://localhost:3000/api",
      "description": "Local server"
    }
  ],
  "paths": {
    "/analyst": {
      "get": {
        "summary": "Get analyst data",
        "description": "Retrieve data for analysis, optionally filtered by date range.",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "Page number for pagination",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "items",
            "in": "query",
            "description": "Number of items per page",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 10
            }
          },
          {
            "name": "from",
            "in": "query",
            "description": "Start date for filtering (YYYY-MM-DD) - optional",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "to",
            "in": "query",
            "description": "End date for filtering (YYYY-MM-DD) - optional",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "example": {
                  "totalPages": 5,
                  "totalItems": 50,
                  "data": [
                    {
                      "day": "2025-04-12",
                      "data": [
                        { "temperature": 25, "humidity": 60 }
                      ]
                    }
                  ]
                }
              }
            }
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/control/fan": {
      "patch": {
        "summary": "Control fan",
        "description": "Turn the fan on or off.",
        "parameters": [
          {
            "name": "data",
            "in": "query",
            "description": "Fan status (1 for ON, 0 for OFF)",
            "required": true,
            "schema": {
              "type": "integer",
              "enum": [0, 1]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Fan status updated successfully"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/control/pump": {
      "patch": {
        "summary": "Control pump",
        "description": "Turn the pump on or off.",
        "parameters": [
          {
            "name": "data",
            "in": "query",
            "description": "Pump status (1 for ON, 0 for OFF)",
            "required": true,
            "schema": {
              "type": "integer",
              "enum": [0, 1]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Pump status updated successfully"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/equipment-status": {
      "get": {
        "summary": "Get equipment status",
        "description": "Retrieve the current status of a specific equipment (fan or pump).",
        "parameters": [
          {
            "name": "value",
            "in": "query",
            "description": "Specify the equipment to retrieve status for (e.g., 'fan' or 'pump').",
            "required": true,
            "schema": {
              "type": "string",
              "enum": ["fan", "pump"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "example": {
                  "value": "ON"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid or missing query parameter"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/mcp/sse": {
      "get": {
        "summary": "Get latest equipment data (fan & pump)",
        "description": "Retrieve the latest data for fan and pump from Adafruit via MCP.",
        "responses": {
          "200": {
            "description": "Successful response with latest equipment data",
            "content": {
              "application/json": {
                "example": {
                  "content": [
                    {
                      "type": "text",
                      "text": {
                        "fan": {
                          "id": "123456",
                          "value": "1",
                          "created_at": "2025-04-26T10:00:00Z"
                        },
                        "pump": {
                          "id": "654321",
                          "value": "0",
                          "created_at": "2025-04-26T10:00:00Z"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/agent": {
      "post": {
        "summary": "AI Smart Farm Agent",
        "description": "Phân tích yêu cầu người dùng và sử dụng AI để chọn công cụ phù hợp.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "message": {
                    "type": "object",
                    "properties": {
                      "text": { "type": "string" }
                    },
                    "required": ["text"]
                  }
                },
                "required": ["message"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Thành công",
            "content": {
              "application/json": {
                "example": { "error": null, "data": "ok" }
              }
            }
          },
          "400": {
            "description": "Lỗi đầu vào hoặc xử lý"
          }
        }
      }
    }
  }
}